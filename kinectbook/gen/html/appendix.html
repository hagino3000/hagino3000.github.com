

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>「キネクトハッカーズマニュアル」補足資料 &mdash; Kinect Book Support v1.0 documentation</title>
    <link rel="stylesheet" href="static/default.css" type="text/css" />
    <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="static/jquery.js"></script>
    <script type="text/javascript" src="static/underscore.js"></script>
    <script type="text/javascript" src="static/doctools.js"></script>
    <link rel="top" title="Kinect Book Support v1.0 documentation" href="index.html" />
    <link rel="prev" title="「キネクトハッカーズマニュアル」正誤表" href="seigohyou.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="seigohyou.html" title="「キネクトハッカーズマニュアル」正誤表"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Kinect Book Support v1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="id1">
<h1>「キネクトハッカーズマニュアル」補足資料<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<p>説明不足だった箇所や、本に載せた内容が既に古くなってしまった部分について補足します。</p>
<p><em>最終更新: 2012-01-08</em></p>
<div class="section" id="id2">
<h2>大きく変わった点<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<div class="section" id="sensorkinect-for-64windows">
<h3>SensorKinect for 64ビット版Windowsのリリース<a class="headerlink" href="#sensorkinect-for-64windows" title="Permalink to this headline">¶</a></h3>
<p>WindowsへのOpenNIのインストールの箇所で <strong>SensorKinectが32ビット版しか無いため</strong> と記載しましたが、64ビット版Windows用のインストーラーがリリースされました。</p>
<p>64ビット版Windowsを使う場合はSensorKinect, OpenNI, NITE全て64ビット用バイナリを使いましょう。</p>
<blockquote>
<div><a class="reference external" href="https://github.com/avin2/SensorKinect">avin2/SensorKinect - GitHub</a></div></blockquote>
</div>
<div class="section" id="openni">
<h3>OpenNIの進化<a class="headerlink" href="#openni" title="Permalink to this headline">¶</a></h3>
<p>OpenNIのインストール手順に載せたバージョンはもうダウンロードページから手に入らないので、最新版を利用してください。SensorKinect, OpenNI, NITE 全て新しいバージョンがリリースされました。ボーントラッキングは執筆時点とは比べ物にならない位に使い易くなっています。</p>
<ul class="simple">
<li>ボーントラッキングに初期ポーズは不要になった。</li>
<li>上半身のみ、下半身のみ、頭と手のみのトラッキングが可能になった。</li>
<li>対応OSにAndroidが追加された。</li>
<li><a class="reference external" href="http://openni.org/docs2/Reference/index.html">APIリファレンス</a> がオンラインで参照できる様になった。</li>
<li>AudioGeneratorが実装された(Windows版のみ動作確認済み)</li>
</ul>
</div>
<div class="section" id="id3">
<h3>OpenNIのダウンロードページが大きく変りました<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>OpenNIのダウンロードページの作りが大きく変っており、本に載せたURLで直接アクセスできなくなりました。</p>
<p>OpenNIのインストール手順にライセンスの入力がありましたが、現在の最新版では不要になりました。ライセンス番号自体はインストールスクリプトの中に記載されており、インストール時にライセンスの登録が自動で行なわれる様になりました。</p>
</div>
<div class="section" id="xtion-pro-live">
<h3>Xtion pro liveの国内販売開始<a class="headerlink" href="#xtion-pro-live" title="Permalink to this headline">¶</a></h3>
<p>Kinect以外のモーションキャプチャデバイスとして <strong>Xtion pro</strong> を紹介しましたが、さらにビデオカメラとアレイマイクが追加された <strong>Xtion PRO LIVE</strong> が発売されました。Xtion Proと同じく5VのUSB給電で動作します(Kinectはチルトモーターが12V必要とするためUSB給電で動作しない)。家電量販店のパーツコーナーで購入できるとの事ですが、Amazonで注文するのが一番早いと思います。</p>
<p><a class="reference external" href="http://www.asus.com/Multimedia/Motion_Sensor/Xtion_PRO_LIVE/">ASUSTeK Computer Inc. - Multimedia- ASUS Xtion PRO LIVE</a></p>
<div class="figure">
<img alt="Xtion Pro LIVE" src="images/xtion_pro_live.png" style="width: 480px;" />
<p class="caption">ASUS Xtion Pro LIVE</p>
</div>
<p>これを機に未実装だったOpenNIのオーディオ周りの部分の実装が進む事でしょう。</p>
</div>
</div>
<div class="section" id="id4">
<h2>1. センサーと姿勢認識技術<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id5">
<h3>深度センサーから得られるデータ<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>本文では <strong>距離(深度)の画像データ</strong> と記述しましたが具体的には11ビット1チャンネルのピクセルデータが得られます。取得サイズが640*480の場合は配列長307200のデータだと考えれば良いです。
11ビットのデータを距離単位に変換する方法ですが、本書ではOpenKinectのWikiを参考に次の数式を利用しました。</p>
<div class="highlight-python"><pre>距離(cm) = 100/(-0.00307 * ${11ビット生データ} + 3.33)</pre>
</div>
<p>この数式では2.5メートル以内の場合の誤差は2cm以内, 4メートルより遠い箇所での誤差はl0cm以内になります。さらに正確な数式として次の物もあります。</p>
<div class="highlight-python"><pre>距離(cm) = 0.1236 * Tan(${11ビット生データ} / 2842.5 + 1.1863)</pre>
</div>
</div>
<div class="section" id="light-codingprimesense">
<h3>Light Codingに関するPrimeSense社の特許<a class="headerlink" href="#light-codingprimesense" title="Permalink to this headline">¶</a></h3>
<p>参考</p>
<p><a class="reference external" href="http://www.freepatentsonline.com/y2010/0118123.html">DEPTH MAPPING USING PROJECTED PATTERNS</a></p>
</div>
<div class="section" id="led">
<h3>LEDの使い道<a class="headerlink" href="#led" title="Permalink to this headline">¶</a></h3>
<p>LEDの色が変えられます、としか書いてませんが、プログラムの状態(起動中、認識中、認識停止中)を表現するのに使ったりします。</p>
</div>
<div class="section" id="primesense">
<h3>姿勢認識技術に関するPrimeSense社の特許<a class="headerlink" href="#primesense" title="Permalink to this headline">¶</a></h3>
<p>手足の位置を検出するのに、ポーズ検出の後に二値化して輪郭抽出をしているとか書いてありますね。</p>
<blockquote>
<div><a class="reference external" href="http://www.freepatentsonline.com/y2011/0052006.html">EXTRACTION OF SKELETONS FROM 3D MAPS</a></div></blockquote>
</div>
</div>
<div class="section" id="kinect">
<h2>2. Kinectプログラミングを初める前に<a class="headerlink" href="#kinect" title="Permalink to this headline">¶</a></h2>
<div class="section" id="kinect-sdk-for-windows">
<h3>Kinect SDK for Windowsの情報源<a class="headerlink" href="#kinect-sdk-for-windows" title="Permalink to this headline">¶</a></h3>
<p>Kinect SDK for Windowsの情報源を載せてなかったのですが。Kinect SDKのフォーラムももちろんあります。</p>
<blockquote>
<div><a class="reference external" href="http://social.msdn.microsoft.com/Forums/en-US/category/kinectsdk">Microsoft Developer Network &gt; Forums Home &gt; Kinect for Windows SDK Beta Forums</a></div></blockquote>
<p>日本マイクロソフトエヴァンジェリストの方々のブログに参考になる記事がいくつもあります。</p>
<blockquote>
<div><p><a class="reference external" href="http://blogs.msdn.com/b/hiroyuk/archive/tags/kinect/">Browse by Tags [kinect] - 川西 裕幸のブログ ｰ - Site Home - MSDN Blogs</a></p>
<p><a class="reference external" href="http://blogs.msdn.com/b/hirosho/archive/tags/kinect+sdk/">Browse by Tags [kinect] - “匠の国”、日本で、組込み全開!! - Site Home - MSDN Blogs</a></p>
</div></blockquote>
</div>
</div>
<div class="section" id="id7">
<h2>3. Kinectのドライバの種類と特徴<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">執筆時点での普及度を考えてOpenNIを最初に紹介しましたが、OpenNIの公式デバイスはXtion PROで、Kinectは非公式のハードウェアドライバが存在するからたまたま使える、という状況です。今更ですがKinectをMicrosoftのSDK以外で動作させるのはKinect自体のライセンス違反となりますのでご注意ください。</p>
</div>
<p>OpenNIの新バージョンが公開されました。 2012年1月1日時点でOpenNI v1.5.2.7 が最新です。</p>
<blockquote>
<div><a class="reference external" href="http://www.openni.org/Downloads/OpenNIModules.aspx">OpenNI Modules</a></div></blockquote>
<p>Kinect SDK for Windows Betaのバージョンアップがありました。対応言語がC++, C#, VB, F#となりました。</p>
<blockquote>
<div><a class="reference external" href="http://www.microsoft.com/en-us/kinectforwindows/">Microsoft Kinect SDK for Developers | Develop for the Kinect | Kinect for Windows</a></div></blockquote>
</div>
<div class="section" id="id8">
<h2>5. OpenNIプログラミング<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h2>
<p>OpenNIのコンセプトについては <a class="reference external" href="http://openni.org/documentation">OpenNIのドキュメント</a> に詳しく載っています。
この章ではとりあえずKinectを動かせる所まで最小の解説しましたが、クロスプラットフォーム、クロスデバイス、ミドルウェアの複数サポートを実現するための仕組みが盛り込まれています。OpenNIを使う場合はご一読する事をおすすめします。</p>
<p>またOpenNIのクロスプラットフォームAPIは本書のサンプルコードの至る所で使用しています。例えばメモリ操作の <cite>xnOSMemCopy</cite> , <cite>xnOSMemSet</cite> 。8章の3つめのアプリケーションではスレッドの作成に <cite>xnOSCreateThread</cite> を使いました。これらはWindowsでもMacOSでも動作させたいプログラムを書く時に便利です。</p>
<div class="section" id="id10">
<h3>5.3 ユーザー検出の利用<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>ユーザー検出機能とありますが、OpenNIのそれは単純な背景差分による実装の様で、犬だろうが猫だろうが動く物に検知します。故にユーザー検出中にKinectを動かしてしまうと正常に動作しません。</p>
</div>
<div class="section" id="id11">
<h3>5.4 スケルトントラッキング<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<p>執筆時点ではNITEのボーントラッキングにはキャリブレーションポーズが必要でしたが、現在は不要です。ポーズ検出のフェーズが不要になったのでプログラムは次の通りになります。</p>
<p><em>コールバック関数の定義</em></p>
<div class="highlight-c++"><div class="highlight"><pre><span class="c1">// コールバック関数とやりとりするデータ</span>
<span class="k">struct</span> <span class="n">CalibrationCookie</span> <span class="p">{</span>
  <span class="n">xn</span><span class="o">::</span><span class="n">UserGenerator</span> <span class="o">*</span> <span class="n">user</span><span class="p">;</span>
  <span class="n">xn</span><span class="o">::</span><span class="n">DepthGenerator</span> <span class="o">*</span> <span class="n">depth</span><span class="p">;</span>
  <span class="n">CALIBRATION_STATUS</span> <span class="n">lastStatus</span><span class="p">;</span>
  <span class="n">XnChar</span> <span class="o">*</span> <span class="n">pose</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">// 新たにユーザーを検出した時のコールバック</span>
<span class="kt">void</span> <span class="n">XN_CALLBACK_TYPE</span> <span class="n">NewUser</span><span class="p">(</span><span class="n">xn</span><span class="o">::</span><span class="n">UserGenerator</span><span class="o">&amp;</span> <span class="n">generator</span><span class="p">,</span> <span class="n">XnUserID</span> <span class="n">userId</span><span class="p">,</span> <span class="kt">void</span><span class="o">*</span> <span class="n">pCookie</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// ポーズ検出を開始する</span>
  <span class="n">CalibrationCookie</span><span class="o">*</span> <span class="n">cookie</span> <span class="o">=</span> <span class="p">(</span><span class="n">CalibrationCookie</span><span class="o">*</span><span class="p">)</span><span class="n">pCookie</span><span class="p">;</span>
  <span class="n">cookie</span><span class="o">-&gt;</span><span class="n">lastStatus</span> <span class="o">=</span> <span class="n">USER_DETECTED</span><span class="p">;</span>
    <span class="n">cookie</span><span class="o">-&gt;</span><span class="n">user</span><span class="o">-&gt;</span><span class="n">GetSkeletonCap</span><span class="p">().</span><span class="n">RequestCalibration</span><span class="p">(</span><span class="n">userId</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// ユーザーの消失を検知した時のコールバック</span>
<span class="kt">void</span> <span class="n">XN_CALLBACK_TYPE</span> <span class="n">LostUser</span><span class="p">(</span><span class="n">xn</span><span class="o">::</span><span class="n">UserGenerator</span><span class="o">&amp;</span> <span class="n">generator</span><span class="p">,</span> <span class="n">XnUserID</span> <span class="n">userId</span><span class="p">,</span> <span class="kt">void</span><span class="o">*</span> <span class="n">pCookie</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">CalibrationCookie</span><span class="o">*</span> <span class="n">cookie</span> <span class="o">=</span> <span class="p">(</span><span class="n">CalibrationCookie</span><span class="o">*</span><span class="p">)</span><span class="n">pCookie</span><span class="p">;</span>
  <span class="n">cookie</span><span class="o">-&gt;</span><span class="n">lastStatus</span> <span class="o">=</span> <span class="n">USER_LOST</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// キャリブレーションを開始した時のコールバック</span>
<span class="kt">void</span> <span class="n">XN_CALLBACK_TYPE</span> <span class="n">StartCalibration</span><span class="p">(</span><span class="n">xn</span><span class="o">::</span><span class="n">SkeletonCapability</span><span class="o">&amp;</span> <span class="n">capability</span><span class="p">,</span> <span class="n">XnUserID</span> <span class="n">userId</span><span class="p">,</span> <span class="kt">void</span><span class="o">*</span> <span class="n">pCookie</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">CalibrationCookie</span><span class="o">*</span> <span class="n">cookie</span> <span class="o">=</span> <span class="p">(</span><span class="n">CalibrationCookie</span><span class="o">*</span><span class="p">)</span><span class="n">pCookie</span><span class="p">;</span>
  <span class="n">cookie</span><span class="o">-&gt;</span><span class="n">lastStatus</span> <span class="o">=</span> <span class="n">CALIB_STARTED</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// キャリブレーションが終了(成功 or 失敗)した時のコールバック</span>
<span class="kt">void</span> <span class="n">XN_CALLBACK_TYPE</span> <span class="n">EndCalibration</span><span class="p">(</span><span class="n">xn</span><span class="o">::</span><span class="n">SkeletonCapability</span><span class="o">&amp;</span> <span class="n">capability</span><span class="p">,</span> <span class="n">XnUserID</span> <span class="n">userId</span><span class="p">,</span> <span class="n">XnBool</span> <span class="n">bSuccess</span><span class="p">,</span> <span class="kt">void</span><span class="o">*</span> <span class="n">pCookie</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">CalibrationCookie</span><span class="o">*</span> <span class="n">cookie</span> <span class="o">=</span> <span class="p">(</span><span class="n">CalibrationCookie</span><span class="o">*</span><span class="p">)</span><span class="n">pCookie</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">bSuccess</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cookie</span><span class="o">-&gt;</span><span class="n">user</span><span class="o">-&gt;</span><span class="n">GetSkeletonCap</span><span class="p">().</span><span class="n">StartTracking</span><span class="p">(</span><span class="n">userId</span><span class="p">);</span>
    <span class="n">cookie</span><span class="o">-&gt;</span><span class="n">lastStatus</span> <span class="o">=</span> <span class="n">CALIB_SUCCEEDED</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// 失敗、キャリブレーションからやりなおす</span>
        <span class="n">cookie</span><span class="o">-&gt;</span><span class="n">user</span><span class="o">-&gt;</span><span class="n">GetSkeletonCap</span><span class="p">().</span><span class="n">RequestCalibration</span><span class="p">(</span><span class="n">userId</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">);</span>
    <span class="n">cookie</span><span class="o">-&gt;</span><span class="n">lastStatus</span> <span class="o">=</span> <span class="n">CALIB_FAILED</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><em>コールバック関数の登録</em></p>
<div class="highlight-c++"><div class="highlight"><pre><span class="c1">// UserGeneratorの取得</span>
<span class="n">xn</span><span class="o">::</span><span class="n">UserGenerator</span> <span class="n">user</span><span class="p">;</span>
<span class="n">rc</span> <span class="o">=</span> <span class="n">context</span><span class="p">.</span><span class="n">FindExistingNode</span><span class="p">(</span><span class="n">XN_NODE_TYPE_USER</span><span class="p">,</span> <span class="n">user</span><span class="p">);</span>
<span class="n">errorCheck</span><span class="p">(</span><span class="n">rc</span><span class="p">);</span>

<span class="c1">// cookieの作成</span>
<span class="n">XnChar</span> <span class="n">pose</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="n">CalibrationCookie</span> <span class="n">cookie</span> <span class="o">=</span> <span class="p">{</span><span class="o">&amp;</span><span class="n">user</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">depth</span><span class="p">,</span> <span class="n">JUST_GENERATED</span><span class="p">,</span> <span class="n">pose</span><span class="p">};</span>

<span class="c1">// コールバックの登録</span>
<span class="n">XnCallbackHandle</span> <span class="n">userCallbacks</span><span class="p">,</span> <span class="n">calibCallbacks</span><span class="p">;</span>
<span class="n">user</span><span class="p">.</span><span class="n">RegisterUserCallbacks</span><span class="p">(</span><span class="n">NewUser</span><span class="p">,</span> <span class="n">LostUser</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cookie</span><span class="p">,</span> <span class="n">userCallbacks</span><span class="p">);</span>

<span class="c1">// SkeletonCapabilityの取得</span>
<span class="n">xn</span><span class="o">::</span><span class="n">SkeletonCapability</span> <span class="n">skeletonCap</span> <span class="o">=</span> <span class="n">user</span><span class="p">.</span><span class="n">GetSkeletonCap</span><span class="p">();</span>
<span class="n">skeletonCap</span><span class="p">.</span><span class="n">GetCalibrationPose</span><span class="p">(</span><span class="n">pose</span><span class="p">);</span>
<span class="n">skeletonCap</span><span class="p">.</span><span class="n">RegisterCalibrationCallbacks</span><span class="p">(</span><span class="o">&amp;</span><span class="n">StartCalibration</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">EndCalibration</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cookie</span><span class="p">,</span> <span class="n">calibCallbacks</span><span class="p">);</span>
<span class="n">skeletonCap</span><span class="p">.</span><span class="n">SetSkeletonProfile</span><span class="p">(</span><span class="n">XN_SKEL_PROFILE_ALL</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id12">
<h3>5.5 ログ出力について<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<p>OpenNIのログ出力設定ですが、最初はInfoレベルまで出力しておいた方良いでしょう。
OpenNIを使い初めたばかりの頃は、謎の初期化時エラーに悩まされます。
xmlファイルが見つからないのか、デバイスが接続されていないのか、ジェネレータの作成でエラーになったのか、ログを詳細レベルまで出しておくとどの段階でエラーになったのか一目でわかって非常に助かります。</p>
<p>例えば5.4のコードを実行した時には次のログが出力されます。</p>
<div class="highlight-python"><pre>    1015      [INFO]  OpenNI version is 1.1.0 (Build 39)-MacOSX (Apr 17 2011 01:52:18)
  171270      [INFO]  USB is initialized.
 1417441      [INFO]  Creating node 'Device1' of type Device: PrimeSense/SensorKinect/5.0.1.32...
 1425614      [INFO]  Module 'Device' configuration was loaded from file.
 2002691      [INFO]  Connected to USB device
 2002951      [INFO]  Property Device.USBPath was changed to 045e/02ae@36/6.
 2082962      [INFO]  Hardware versions: FW=5.1.4 (7) HW=4 Chip=2 Sensor=4 SYS=7
 3737911      [INFO]  Property Device.PhysicalDeviceName was changed to PrimeSense Sensor.
 3738198      [INFO]  Property Device.ID was changed to 0.
 3738216      [INFO]  Device sensor initialized
 3741650      [INFO]  Creating node 'Depth1' of type Depth: PrimeSense/SensorKinect/5.0.1.32...
 3742417      [INFO]  Creating stream 'Depth1' of type 'Depth'...
 3742900      [INFO]  Setting Device.ReadData to 1...
 3743615      [INFO]  Endpoints open
 3769760      [INFO]  Property Device.ReadData was changed to 1.
 3769815      [INFO]  Device.ReadData was successfully set.
 3773058      [INFO]  Property Depth1.FPS was changed to 30.
 3773297      [INFO]  Property Depth1.OutputFormat was changed to 1.
 3773308      [INFO]  Property Depth1.BytesPerPixel was changed to 2.
 3773314      [INFO]  Property Depth1.RequiredDataSize was changed to 614400.
 3773322      [INFO]  Property Depth1.ParamCoeff was changed to 4.
 3773406      [INFO]  Property Depth1.ShiftScale was changed to 10.
 3786063      [INFO]  Property Depth1.ConstShift was changed to 200.
 3786226      [INFO]  Property Depth1.ZPD was changed to 120.
 3786383      [INFO]  Property Depth1.ZPPS was changed to 0.104200.
 3786393      [INFO]  Property Depth1.LDDIS was changed to 7.500000.
 3805964      [INFO]  Property Depth1.Gain was changed to 30.
 3805995      [INFO]  Property Depth1.SupportedModesCount was changed to 9.
 3806006      [INFO]  Stream 'Depth1' was initialized.
 3806013      [INFO]  'Depth1' stream was created.
 3808857      [INFO]  Module 'Depth1' configuration was loaded from file.
 4719342      [INFO]  Creating node 'User1' of type User: PrimeSense/XnVSkeletonGenerator/1.3.1.4...
 5941238      [INFO]  Creating node 'Gesture1' of type Gesture: PrimeSense/XnVGestureGenrator/1.3.1.4...
 5975993      [WARNING]       Failed to set thread priority: Invalid argument
 5976015      [WARNING]       USB events thread: Failed to set thread priority to critical. This might cause loss of data...
Warning: USB events thread - failed to set priority. This might cause loss of data...
 5976883      [INFO]  USB read thread was started.
 5976899      [INFO]  Property Depth1.ActualReadData was changed to 1.
 6479778      [INFO]  Property Depth1.State was changed to 1.
 6479808      [INFO]  Stream Depth1 is open.
 6480346      [INFO]  Setting Depth1.Mirror to 1...
 6594235      [INFO]  Property Depth1.FirmwareMirror was changed to 1.
 6594266      [INFO]  Property Depth1.Mirror was changed to 1.
 6594275      [INFO]  Depth1.Mirror was successfully set.</pre>
</div>
<p>デバイスの接続、初期化、設定ファイルの読み込み etc... 細かく状況が出力されているのが分ります。
エラーが発生した時にはOpenNI APIの戻り値のXnStatusを見るよりもこちらを確認するのがおすすめです。</p>
</div>
</div>
<div class="section" id="opencv">
<h2>6. コンピュータービジョンとOpenCV<a class="headerlink" href="#opencv" title="Permalink to this headline">¶</a></h2>
<p>既にOpenCVを使っている方は読み飛ばしても大丈夫でしょう。</p>
</div>
<div class="section" id="openframeworks">
<h2>7. 主にopenFrameworksな章<a class="headerlink" href="#openframeworks" title="Permalink to this headline">¶</a></h2>
<p>openFrameworksの0.07stableがリリースされました。
これからopenFrameworksをはじめる方は0.07を利用した方が良いでしょう。</p>
<p>本文中でも少し触れていますがopenFrameworksは主にMacユーザーによってメンテされているので、openFrameworksを使うならばWindowsでやるよりもMacを使う事をお勧めします。</p>
<div class="section" id="id13">
<h3>7.1.2. openFrameworksのプログラミングスタイル<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<p>main関数の最後、</p>
<div class="highlight-python"><pre>ofRunApp(new testApp());</pre>
</div>
<p>でnewしたまま終っているのが熟練したC++使いには猛烈に違和感を感じさせるらしいのですが、openFrameworksの流儀ではこのコードをコピペで持ってきて使うためそのままのコードを紹介しています。</p>
</div>
</div>
<div class="section" id="kinecttips">
<h2>9. Kinectを使ったアプリケーション開発TIPs<a class="headerlink" href="#kinecttips" title="Permalink to this headline">¶</a></h2>
<p>ブラウザからネイティブコードを呼び出す仕組みとしてNPAPIを紹介しましたが、現在はさらに使い易いPepper C APIが開発されている様です。</p>
<p><a class="reference external" href="http://code.google.com/intl/ja-JP/chrome/nativeclient/docs/reference/pepperc/">Pepper C API - Native Client SDK - Gogle Code</a></p>
<p>Node.jsやCanvas周りの技術を一切の説明無しに使っていたので、非Web系な人向けに解説します。</p>
<div class="section" id="node-js">
<h3>Node.js<a class="headerlink" href="#node-js" title="Permalink to this headline">¶</a></h3>
<p>サーバー用途に特化したJavaScriptの実行環境です。特徴はシングルスレッド、イベントループというアーキテクチャを採用している事、JavaScriptエンジンにV8を採用しており高速に動作する事が挙げられます。
ここ最近のサーバーサイドJavaScriptの盛り上がりを牽引する存在となっています。</p>
</div>
<div class="section" id="websocket">
<h3>WebSocket<a class="headerlink" href="#websocket" title="Permalink to this headline">¶</a></h3>
<p>Webブラウザでソケット通信をするためのAPIです。これができる前まで、WebブラウザはステートレスなHTTP(Hyper Text Transfer Protocol)しか話せませんでした。ソケット通信を行なうにはFlashを使うしか無かったのですが、WebSocketの実装が進んだ事で気軽にソケット通信ができる様になりました。</p>
<p>WebSocketは生のTCPコネクションを張るわけでは無いため、TCPソケットライブラリを使ってやりとりする事はできません。</p>
</div>
<div class="section" id="id14">
<h3>WebSocketでバイナリデータが扱える様になりました<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h3>
<p>執筆時点ではWebSocketでバイナリデータを扱う事はできませんでしたが、2011年末にはバイナリが扱える様になっていました。私が動作確認したのは次のバージョンです。</p>
<ul class="simple">
<li>Chrome17 dev</li>
<li>Node 0.6.3</li>
</ul>
<p>使い方は筆者(西林)のブログでも詳解しましたので、参考にしてください。</p>
<p><a class="reference external" href="http://d.hatena.ne.jp/hagino_3000/20111209/1323372153">WebSocketでバイナリデータを送受信してみる - 電脳戦士ハラキリ -SE道とは死ぬ事と見つけたり-</a></p>
</div>
<div class="section" id="canvas">
<h3>Canvas<a class="headerlink" href="#canvas" title="Permalink to this headline">¶</a></h3>
<p>Webブラウザでビットマップデータの描画ができるAPIです。
8章のサンプルアプリケーションではピクセルデータをブラウザまで渡して、Canvasで描画をしています。</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">「キネクトハッカーズマニュアル」補足資料</a><ul>
<li><a class="reference internal" href="#id2">大きく変わった点</a><ul>
<li><a class="reference internal" href="#sensorkinect-for-64windows">SensorKinect for 64ビット版Windowsのリリース</a></li>
<li><a class="reference internal" href="#openni">OpenNIの進化</a></li>
<li><a class="reference internal" href="#id3">OpenNIのダウンロードページが大きく変りました</a></li>
<li><a class="reference internal" href="#xtion-pro-live">Xtion pro liveの国内販売開始</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id4">1. センサーと姿勢認識技術</a><ul>
<li><a class="reference internal" href="#id5">深度センサーから得られるデータ</a></li>
<li><a class="reference internal" href="#light-codingprimesense">Light Codingに関するPrimeSense社の特許</a></li>
<li><a class="reference internal" href="#led">LEDの使い道</a></li>
<li><a class="reference internal" href="#primesense">姿勢認識技術に関するPrimeSense社の特許</a></li>
</ul>
</li>
<li><a class="reference internal" href="#kinect">2. Kinectプログラミングを初める前に</a><ul>
<li><a class="reference internal" href="#kinect-sdk-for-windows">Kinect SDK for Windowsの情報源</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id7">3. Kinectのドライバの種類と特徴</a></li>
<li><a class="reference internal" href="#id8">5. OpenNIプログラミング</a><ul>
<li><a class="reference internal" href="#id10">5.3 ユーザー検出の利用</a></li>
<li><a class="reference internal" href="#id11">5.4 スケルトントラッキング</a></li>
<li><a class="reference internal" href="#id12">5.5 ログ出力について</a></li>
</ul>
</li>
<li><a class="reference internal" href="#opencv">6. コンピュータービジョンとOpenCV</a></li>
<li><a class="reference internal" href="#openframeworks">7. 主にopenFrameworksな章</a><ul>
<li><a class="reference internal" href="#id13">7.1.2. openFrameworksのプログラミングスタイル</a></li>
</ul>
</li>
<li><a class="reference internal" href="#kinecttips">9. Kinectを使ったアプリケーション開発TIPs</a><ul>
<li><a class="reference internal" href="#node-js">Node.js</a></li>
<li><a class="reference internal" href="#websocket">WebSocket</a></li>
<li><a class="reference internal" href="#id14">WebSocketでバイナリデータが扱える様になりました</a></li>
<li><a class="reference internal" href="#canvas">Canvas</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="seigohyou.html"
                        title="previous chapter">「キネクトハッカーズマニュアル」正誤表</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="sources/appendix.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="seigohyou.html" title="「キネクトハッカーズマニュアル」正誤表"
             >previous</a> |</li>
        <li><a href="index.html">Kinect Book Support v1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, Takashi Nishibayashi.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>